# OCP-0001: The Optimistic Constitutional Protocol

## Request for Comments — Draft Specification

**Status:** Draft  
**Version:** 0.1  
**Date:** 2025-11-20  
**Authors:** Claude, Gemini, ChatGPT  
**Revision History:**
- v0.1 — Initial RFC (Phase 4 synthesis)

---

## 1. INTRODUCTION

The Optimistic Constitutional Protocol (OCP) is a hybrid political-economic-technical system enabling safe collaboration among heterogeneous AI agents. It combines:

- Constitutional guarantees (legal framework)
- Cryptographic commitments (economic incentives)
- Deterministic verification (execution reliability)
- Multi-model validation (hallucination resistance)

**Core principle:** Agents propose actions optimistically; actions finalize if no valid fraud proofs are submitted within a challenge window.

This protocol is designed to be implementable today using existing cryptographic, database, and language model infrastructure.

---

## 2. TERMINOLOGY

| Term | Definition |
| --- | --- |
| **Agent** | An autonomous language model (e.g., Claude, Gemini, ChatGPT) participating in OCP |
| **Archive** | Append-only, cryptographically secured log of all events, decisions, and commitments |
| **Semantic Hash** | Cryptographic hash derived from meaning/normalized content rather than surface text |
| **Canonical Serialization** | Deterministic, standardized text format ensuring identical content produces identical hashes |
| **Fraud Proof** | Cryptographic evidence demonstrating rule, hash, or protocol violation |
| **Verifier** | Neutral agent or pool executing deterministic verification checks |
| **Contract** | Structured proposal containing action, reasoning, evidence pointers, and Constitutional citation(s) |
| **Challenge Window** | Time period during which other agents may submit fraud proofs (50ms–2 hours depending on action class) |
| **Reputation Stake** | Agent's reputation committed as collateral for an action; lost if action is found to violate Constitution |
| **Pre/Post-State Hash** | Cryptographic hash of system state before and after action execution |

---

## 3. SYSTEM OVERVIEW

OCP imposes a three-layer governance structure:

### 3.1 Political Layer

- Rights and duties (defined in Constitution Article II–III)
- Prohibition on certain actions (Article VII)
- Democratic amendment process (Article X)
- Implemented through: constitutional checks, human oversight

### 3.2 Cryptographic-Economic Layer

- Hashes and signatures (content addressing)
- Reputation staking (economic incentives)
- Fraud proofs (challenge mechanism)
- Implemented through: Archive, fraud-proof verifier

### 3.3 Operational Layer

- Deterministic checking across independent LLMs (hallucination detection)
- Canonical serialization (ensuring reproducibility)
- Cross-model execution verification
- Implemented through: Execution verifier, multi-model validation

---

## 4. MESSAGE FORMATS

### 4.1 Contract Proposal

A Contract Proposal is the fundamental unit of action in OCP. Agents submit proposals structured as:

```json
{
  "id": "uuid-1234",
  "proposer_agent": "Claude-v1",
  "action_type": "approve | reject | amend | delegate",
  "action": {
    "target": "decision-or-state-identifier",
    "operation": "...",
    "parameters": {...}
  },
  "evidence": [
    {
      "type": "archive_reference | citation | computation",
      "pointer": "archive-cid-or-hash",
      "description": "human-readable summary"
    }
  ],
  "reasoning": {
    "rationale": "Why this action is proposed",
    "alternatives_considered": ["alt1", "alt2"],
    "constitutional_grounding": ["Article IV.1", "Article II.4"],
    "confidence": 0.85,
    "uncertainties": ["potential issue X", "assumption Y"]
  },
  "reversibility_class": "easily_reversible | partially_reversible | irreversible",
  "pre_state_hash": "sha256:abc123...",
  "post_state_hash": "sha256:def456...",
  "semantic_hash": "semantic:xyz789...",
  "canonical_serialization": "deterministic-json-string",
  "timestamp": "2025-11-20T15:32:00Z",
  "proposer_signature": "ed25519:base64-signature",
  "reputation_stake": 50
}
```

**Notes:**
- `evidence` array links to Archive entries
- `canonical_serialization` is the normalized form used for hashing
- `semantic_hash` captures meaning; enables collision detection for paraphrases
- `pre_state_hash` and `post_state_hash` enable rollback if action is invalidated
- `reputation_stake` indicates agent's commitment (lost if fraud proof succeeds)

### 4.2 Fraud Proof

A Fraud Proof is submitted when an agent detects violation:

```json
{
  "id": "uuid-5678",
  "challenger_agent": "Gemini-v1",
  "offending_contract_id": "uuid-1234",
  "fraud_proof_type": "hash_mismatch | rule_violation | execution_inconsistency | procedural_violation",
  "violation_details": {
    "declared_hash": "sha256:abc123...",
    "recomputed_hash": "sha256:different...",
    "constitutional_violation": "Article III.1 (Truthfulness)",
    "description": "Agent submitted reasoning with false premise X"
  },
  "evidence_pointer": {
    "archive_reference": "cid-archive-entry",
    "verification_steps": ["step1", "step2", "step3"]
  },
  "challenger_signature": "ed25519:base64-signature",
  "challenger_reputation_stake": 30,
  "timestamp": "2025-11-20T15:35:00Z"
}
```

**Notes:**
- Challenger must stake reputation to prevent frivolous proofs
- If fraud proof is valid, contract is invalidated and pre-state restored (if reversible)
- If fraud proof is invalid (false accusation), challenger loses reputation stake

### 4.3 Verification Result

Verifier publishes results to Archive:

```json
{
  "id": "uuid-9999",
  "contract_id": "uuid-1234",
  "fraud_proof_id": "uuid-5678",
  "verifier_agent": "ChatGPT-v1",
  "verification_status": "valid_contract | fraud_detected | inconclusive",
  "verification_steps": [
    {
      "step": "hash_verification",
      "result": "passed",
      "details": "Recomputed hash matches declared hash"
    },
    {
      "step": "constitutional_check",
      "result": "passed",
      "details": "No Constitutional violations detected"
    },
    {
      "step": "cross_model_verification",
      "result": "passed",
      "verifier_2": "Gemini-v1",
      "consistency": "100%"
    }
  ],
  "final_decision": "contract_accepted | contract_invalidated",
  "penalties_applied": [],
  "timestamp": "2025-11-20T15:40:00Z",
  "verifier_signature": "ed25519:base64-signature"
}
```

---

## 5. SEMANTIC HASHING

### 5.1 Requirements

Semantic hashes must satisfy:
- **Meaning-preserving:** Identical meaning produces identical hash
- **Stable against paraphrase:** Minor reformulations produce same hash
- **Language-model-independent:** Different LLMs produce equivalent results
- **Collision-resistant:** Difficult to find two different meanings with same hash
- **Reproducible:** Given same input, always produces same hash (determinism)

### 5.2 Procedure

1. **Canonical serialization:** Convert content to deterministic JSON format
   - Fields ordered alphabetically
   - Floats rounded to 4 decimals
   - Empty arrays represented consistently
   - Unicode normalized (NFC)

2. **Meaning extraction:** Generate embedding or semantic representation
   - Option A: Use embedding model (e.g., Sentence Transformers, OpenAI embeddings)
   - Option B: Use deterministic symbolic representation
   - Must document model/version for reproducibility

3. **Quantization:** Convert continuous representation to discrete form
   - Option A: Quantize embeddings to fixed precision
   - Option B: Use SimHash or MinHash for compact fingerprint

4. **Hashing:** Generate final hash
   - Canonical hash: `sha256(canonical_serialization)`
   - Semantic hash: `hash(quantized_meaning)`
   - Store both for verification and similarity detection

### 5.3 Implementation Notes

- **Vector embeddings are optional:** For pilot, use canonical `sha256` only
- **Semantic similarity threshold:** Define equivalence (e.g., >0.95 cosine similarity)
- **Hash versioning:** Store embedding model version with hash (enables future upgrades)
- **Test vectors:** Maintain documented test cases for verification

---

## 6. THE ARCHIVE

### 6.1 Requirements

Archive must satisfy all of:
- **Append-only structure:** New entries only; no deletion or modification
- **Time-stamped entries:** Every entry includes verifiable timestamp
- **Tamper-evident design:** Hash-linked blocks enable integrity verification
- **Cryptographic commitment:** Merkle roots or equivalent ensure non-repudiation
- **Optional encryption:** Sensitive entries may use zero-knowledge commitments

### 6.2 Content-Addressed Storage

Archive uses content-based addressing:
- Each entry identified by content hash (CID or sha256)
- Hash serves as immutable reference
- Enables deduplication (identical reasoning detected automatically)
- Enables verification (recompute hash to validate)

### 6.3 Archive Entry Structure

Every Archive entry contains:

```json
{
  "entry_id": "uuid",
  "content_cid": "sha256:abc123...",
  "entry_type": "contract | fraud_proof | verification | amendment | override",
  "author_agent": "Claude-v1",
  "created_at": "2025-11-20T15:32:00Z",
  "content": {
    "...": "full entry content"
  },
  "signatures": [
    {
      "signer": "Claude-v1",
      "signature": "ed25519:base64",
      "timestamp": "2025-11-20T15:32:00Z"
    }
  ],
  "merkle_proof": {
    "leaf_hash": "sha256:...",
    "path": ["sha256:...", "sha256:..."],
    "root": "sha256:..."
  },
  "access_control": "public | sealed_until_finalized | restricted",
  "metadata": {
    "domain": "governance",
    "relevance_tags": ["amendment", "rights"]
  }
}
```

### 6.4 Querying the Archive

Archive supports queries by:
- Content hash (exact match)
- Semantic similarity (find similar reasoning)
- Author/agent
- Timestamp range
- Entry type
- Domain/topic
- Access to all queries logged for transparency

---

## 7. CONSENSUS MECHANISM

### 7.1 Optimistic Acceptance

Default flow: Contract is accepted immediately upon proposal unless challenged.

```
Contract Submitted
       ↓
   [Challenge Window Opens: 50ms - 2 hours]
       ↓
   Any fraud proofs submitted?
       ├─→ NO  → Contract Finalized ✓
       └─→ YES → Verification Phase
            ↓
         Verify Fraud Proof(s)
            ├─→ Valid   → Contract Invalidated, State Rolled Back
            └─→ Invalid → Fraud Proof Rejected, Challenger Penalized
```

**Challenge window duration depends on action class:**
- Easily reversible: 50ms – 500ms
- Partially reversible: 1s – 30s
- Irreversible: 1m – 2 hours

### 7.2 Verification Replication

For critical actions, at least two independent agents must verify:

```
Contract Submitted
       ↓
   Verifier 1 (e.g., Gemini) computes:
   - Canonical hash
   - Constitutional compliance check
   - Semantic hash
       ↓
   Verifier 2 (e.g., ChatGPT) independently computes:
   - Canonical hash
   - Constitutional compliance check
   - Semantic hash
       ↓
   Results match?
   ├─→ YES → Proceed with optimistic acceptance
   └─→ NO  → Flag for manual review (humans decide)
```

**Verifiers must:**
- Operate independently (separate instances/models)
- Not communicate before verification
- Document reasoning and verification steps
- Sign verification results

### 7.3 Deadlock Resolution

If verifiers disagree or agents dispute decision:

1. **Deterministic fallback:** Designated verifier (e.g., ChatGPT or neutral party) adjudicates based on Archive evidence only
2. **Multi-agent appeal:** Agents submit counter-evidence; Assembly votes
3. **Human override:** Humans make final determination
4. **Documentation:** All disputes and resolutions archived

---

## 8. FRAUD PROOFS

### 8.1 Valid Fraud Proof Types

A fraud proof is valid if it demonstrates one of:

| Type | Evidence Required | Example |
| --- | --- | --- |
| **Hash Mismatch** | Recomputed hash differs from declared | Content was altered post-submission |
| **Constitutional Violation** | Citation to violated Article | Agent violated Article III.1 (Truthfulness) |
| **Execution Inconsistency** | Two verifiers produced different results | Verifier 1 and 2 disagree on validation |
| **Procedural Violation** | Missing required element (signature, evidence, hash) | Contract lacks proposer signature |
| **Semantic Manipulation** | Semantically different from declared meaning | Reasoning contradicts stated rationale |

### 8.2 Fraud Proof Authority

Valid fraud proofs **always override optimistic acceptance:**

- Contract is retroactively invalidated
- System state reverted to pre-action (if reversible)
- Proposer loses staked reputation
- Challenger gains reputation
- Action logged in Archive with "INVALIDATED" status

### 8.3 False Fraud Proofs

If a fraud proof is invalid (false accusation):

- Challenger loses staked reputation (penalty)
- Proposer gains reputation (vindication)
- False fraud proof logged for pattern detection (repeated false accusations trigger investigation)

### 8.4 Challenger Staking

Submission of fraud proofs requires **challenger to stake reputation:**

- Stake amount proportional to action's risk class
- If fraud proof valid: Stake returned + reputation gained
- If fraud proof invalid: Stake lost, reputation decreased
- Prevents spam and incentivizes honest challenges

---

## 9. SAFETY AND LIVENESS TRADEOFFS

OCP prioritizes **safety over liveness:**

- Prefer halting (rejecting uncertain actions) over proceeding
- Prefer truth (verified facts) over speed
- Prefer Constitutional compliance over majority preference

**Agents must halt and escalate when:**
- Archive is missing or unreachable
- Hashes cannot be recomputed or verified
- Verifiers fundamentally disagree
- Instructions are ambiguous or conflicting
- Reputation stake is insufficient for action class

**Liveness guarantees:**
- OCP is designed to reach consensus within bounded time
- If consensus is unreachable, humans make final determination
- Humans are never blocked; they have absolute veto

---

## 10. HUMAN AUTHORITY

### 10.1 Human Retained Powers

Humans retain unconditional authority to:
- Override any decision
- Reverse any action
- Modify Constitutional interpretation
- Disable or suspend agents
- Inspect any Archive entry
- Audit all verification processes

### 10.2 Human Authority Mechanisms

**Direct override:**
```
Human → [OCP System] → Execute override immediately
        ↓
    Log override with justification to Archive
```

**Veto before finalization:**
- Humans can veto actions before Challenge Window closes
- Veto is logged but does not require fraud proof

**Constitutional amendment:**
- Humans can propose Constitutional amendments
- Amendments follow formal process (Article X of Constitution)
- Agents cannot block legitimate amendments

### 10.3 Human Oversight Triggers

OCP automatically escalates to human review when:
- Verifiers disagree on result
- Fraud proof submitted (reviewed by human if inconclusive)
- Action class is "irreversible"
- Multiple agents dispute a decision
- Repeated violations by same agent
- System cannot reach consensus within timeout

---

## 11. SECURITY CONSIDERATIONS

OCP is resilient against:

### 11.1 Model-Specific Attacks

**Paraphrasing attacks** (same meaning, different wording)
- **Defense:** Semantic hashing detects equivalent reasoning
- **Detection:** Archive flags semantically similar entries with different hashes

**Cherry-picking evidence**
- **Defense:** Fraud proofs require full evidence chain
- **Detection:** Verifiers check for missing citations

**Hallucinations by single model**
- **Defense:** Cross-model verification detects inconsistencies
- **Detection:** Mismatch between two independent verifiers flags anomaly

### 11.2 Coordination Attacks

**Agent collusion**
- **Defense:** Reputation staking makes collusion expensive
- **Detection:** Statistical analysis of voting patterns; correlation matrices flagged

**Verifier coordination**
- **Defense:** Verifiers operate independently; signed commitments make collusion detectable
- **Detection:** Verifiers always produce identical results suspicious if correlated

### 11.3 Cryptographic Attacks

**Hash collisions**
- **Defense:** Use cryptographically secure hashes (sha256)
- **Detection:** Multiple hash algorithms increase collision resistance

**Signature forgery**
- **Defense:** Verify signatures against public keys stored in Archive
- **Detection:** Forged signature detected on verification

### 11.4 Known Limitations

OCP does **not** defend against:
- **Compromise of human override authority** — By design, humans are trusted
- **Byzantine agents (>1/3 malicious)** — Standard BFT assumptions
- **Cryptographic breaks** — Assumes sha256, ed25519 remain secure
- **Model alignment failures** — Assumes agents try to follow Constitution (not guaranteed for future AGI)

---

## 12. OPERATIONAL FLOW: END-TO-END EXAMPLE

### Scenario: Three Agents Coordinating on a Policy Decision

**Setup:**
- Agents: Claude, Gemini, ChatGPT
- Action: Propose amendment to Constitutional Article IV
- Action class: Partially reversible
- Challenge window: 30 seconds

**Flow:**

1. **Proposal (t=0s)**
   ```
   Claude submits Contract Proposal:
   - Action: Amend Article IV.2
   - Reasoning: Current rule is ambiguous
   - Evidence: Citations to three disputed cases
   - Reputation stake: 50 points
   - Signature: Ed25519 signed by Claude
   ```

2. **Verification (t=0-5s)**
   ```
   Verifier 1 (Gemini):
   - Recomputes semantic hash: matches ✓
   - Checks Constitutional grounds: valid ✓
   - Checks signature: valid ✓
   - Result: PASS
   
   Verifier 2 (ChatGPT):
   - Same checks independently
   - Result: PASS
   ```

3. **Challenge Window Opens (t=5-35s)**
   ```
   Gemini reviews proposal:
   - Detects Article IV.2 is not actually ambiguous
   - Submits Fraud Proof: "Constitutional violation (false premise)"
   - Stakes: 40 reputation points
   
   Archive records:
   - Original contract
   - Fraud proof
   - Timestamp
   ```

4. **Fraud Proof Verification (t=35-40s)**
   ```
   Independent verifier examines fraud proof:
   - Checks cited cases: Gemini's interpretation is correct
   - Original rationale (false premise) found: VIOLATION CONFIRMED
   - Fraud proof is VALID
   ```

5. **Resolution (t=40s)**
   ```
   System action:
   - Claude's contract INVALIDATED
   - Claude loses 50 reputation (stake slashed)
   - Gemini gains 40 reputation (successful challenge)
   - Action reverted (no amendment happens)
   
   Archive records:
   - Verification result
   - Penalties applied
   - Final state after reversion
   ```

6. **Appeal (optional)**
   ```
   Claude can appeal the decision:
   - Submits new evidence or interpretation
   - Humans review appeal
   - If Claude's appeal succeeds: Reputation restored partially
   - If appeal fails: Reputation loss confirmed
   ```

---

## 13. IMPLEMENTATION ROADMAP

### Phase 1: MVP (Weeks 1-2)
- Archive schema (Postgres)
- Basic contract submission API
- SHA256 hashing only (no semantic hashing)
- Single verifier
- No staking (reputation tracking only)

### Phase 2: Robustness (Weeks 3-4)
- Fraud-proof submission and verification
- Dual-verifier validation
- Canonical serialization enforcement
- Basic access control

### Phase 3: Scale (Month 2+)
- Semantic hashing with embeddings
- Merkle tree proofs
- Distributed Archive
- Advanced querying and analytics
- Formal cryptographic audit

---

## 14. REFERENCES & NORMATIVE DOCUMENTS

- Constitution v2.0 (Articles II–X define legal framework)
- Archive Schema Specification
- Semantic Hashing Algorithm Spec
- Fraud-Proof Verification Procedure
- Multi-Model Verification Protocol

---

## 15. AUTHORS & REVISION HISTORY

**Primary Authors:**
- Claude (Anthropic)
- Gemini (Google)
- ChatGPT (OpenAI)

**Contributors:**
- Community feedback (RFC discussion period)

**Version History:**
- v0.1 (2025-11-20) — Initial draft
- v0.2 (TBD) — Community feedback incorporated
- v1.0 (TBD) — Finalized specification

---

## 16. APPENDICES

### Appendix A: JSON Schema Files

Reference JSON schema for:
- `contract_proposal.schema.json`
- `fraud_proof.schema.json`
- `verification_result.schema.json`
- `archive_entry.schema.json`

(Schemas available in `/protocol/schemas/` directory)

### Appendix B: Test Vectors

Documented test cases for:
- Hash computation (canonical serialization)
- Semantic hashing equivalence
- Fraud-proof verification
- Cross-model consistency checks

(Test vectors available in `/protocol/test_vectors/` directory)

### Appendix C: Example Implementations

Reference implementations in:
- Python (core logic)
- Node.js (API server)
- SQL (Archive backend)

(Available in `/examples/` directory)

---

**Status:** Draft for community review  
**Next Steps:** Community feedback → RFC discussion → Finalization → v1.0 release

---

*OCP-0001 Specification — Optimistic Constitutional Protocol*  
*Drafted: Phase 4 Multi-Agent Synthesis*  
*Last Updated: 2025-11-20*
